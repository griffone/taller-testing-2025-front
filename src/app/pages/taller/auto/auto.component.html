<div class="p-mb-4">
    <h2>Gestión de Autos</h2>
</div>

<p-panel header="Agregar Auto">
    <form (ngSubmit)="saveAuto()" #autoForm="ngForm">
        <div class="p-fluid grid">
            <div class="col-12 md:col-6 lg:col-3">
                <div class="p-field">
                    <label for="patente">Patente</label>
                    <input id="patente" pInputText [(ngModel)]="auto.patente" type="text" name="patente" 
                           placeholder="Insertar la patente" required />
                </div>
            </div>
            <div class="col-12 md:col-6 lg:col-3">
                <div class="p-field">
                    <label for="marca">Marca</label>
                    <input id="marca" pInputText [(ngModel)]="auto.marca" type="text" name="marca" 
                           placeholder="Insertar la marca" required />
                </div>
            </div>
            <div class="col-12 md:col-6 lg:col-3">
                <div class="p-field">
                    <label for="modelo">Modelo</label>
                    <input id="modelo" pInputText [(ngModel)]="auto.modelo" type="text" name="modelo" 
                           placeholder="Insertar el modelo" required />
                </div>
            </div>
            <div class="col-12 md:col-6 lg:col-3">
                <div class="p-field">
                    <label for="anio">Año</label>
                    <p-inputNumber id="anio" [(ngModel)]="auto.anio" name="anio" 
                                 placeholder="Insertar el año" [min]="1900" [max]="2025" required />
                </div>
            </div>
            <div class="col-12 flex justify-end">
                <p-button label="Guardar" type="submit" icon="pi pi-check" iconPos="right" 
                         [disabled]="!autoForm.valid" />
            </div>
        </div>
    </form>
</p-panel>

<p-table [value]="autos" [paginator]="true" [rows]="10" [responsive]="true" 
         [globalFilterFields]="['patente','marca','modelo']" #dt>
    <ng-template pTemplate="caption">
        <div class="flex justify-between">
            <p-button type="button" icon="pi pi-filter-slash" label="Limpiar" 
                     (click)="clear(dt)" class="p-button-outlined"/>            <span class="p-input-icon-left ml-auto">
                <i class="pi pi-search"></i>
                <input pInputText type="text" (input)="onSearch($event)" 
                       placeholder="Buscar..." />
            </span>
        </div>
    </ng-template>
    <ng-template pTemplate="header">
        <tr>
            <th pSortableColumn="patente">Patente <p-sortIcon field="patente"></p-sortIcon></th>
            <th pSortableColumn="marca">Marca <p-sortIcon field="marca"></p-sortIcon></th>
            <th pSortableColumn="modelo">Modelo <p-sortIcon field="modelo"></p-sortIcon></th>
            <th pSortableColumn="anio">Año <p-sortIcon field="anio"></p-sortIcon></th>
            <th pSortableColumn="cliente">Nombre del Cliente <p-sortIcon field="cliente"></p-sortIcon></th>
            <th>Estado</th>
            <th>Acciones</th>
        </tr>
    </ng-template>
    <ng-template pTemplate="body" let-auto>
        <tr>
            <td>{{auto.patente}}</td>
            <td>{{auto.modelo.marca.nombre}}</td>
            <td>{{auto.modelo.nombre}}</td>
            <td>{{auto.anio}}</td>
            <td>{{auto.cliente.nombre}}</td>
            <td>
                <p-tag [value]="auto.estado ? 'Activo' : 'Inactivo'"
                       [severity]="auto.estado ? 'success' : 'danger'"></p-tag>
            </td>
            <td>
                <div class="flex gap-2">
                    <button pButton icon="pi pi-pencil" class="p-button-rounded p-button-warning" 
                            (click)="editAuto(auto)"></button>
                    <button pButton icon="pi pi-trash" class="p-button-rounded p-button-danger" 
                            (click)="deleteAuto(auto.id)"></button>
                </div>
            </td>
        </tr>
    </ng-template>
    <ng-template pTemplate="emptymessage">
        <tr>
            <td colspan="8">No se encontraron autos.</td>
        </tr>
    </ng-template>
</p-table>

<p-dialog [(visible)]="autoDialog" [style]="{width: '450px'}" header="Detalles del Auto" [modal]="true" 
          class="p-fluid">
    <ng-template pTemplate="content">
        <div class="p-field">
            <label for="patente">Patente</label>
            <input type="text" pInputText id="patente" [(ngModel)]="editingAuto.patente" required autofocus />
        </div>
        <div class="p-field">
            <label for="marca">Marca</label>
            <input type="text" pInputText id="marca" [(ngModel)]="editingAuto.marca" required />
        </div>
        <div class="p-field">
            <label for="modelo">Modelo</label>
            <input type="text" pInputText id="modelo" [(ngModel)]="editingAuto.modelo" required />
        </div>
        <div class="p-field">
            <label for="anio">Año</label>
            <p-inputNumber id="anio" [(ngModel)]="editingAuto.anio" [min]="1900" [max]="2025" required />
        </div>
        <div class="p-field">
            <label for="kilometraje">Kilometraje</label>
            <p-inputNumber id="kilometraje" [(ngModel)]="editingAuto.kilometraje" [min]="0" required />
        </div>
        <div class="p-field">
            <label for="cilindrada">Cilindrada</label>
            <p-inputNumber id="cilindrada" [(ngModel)]="editingAuto.cilindrada" [min]="0" required />
        </div>
    </ng-template>
    <ng-template pTemplate="footer">
        <button pButton pRipple label="Cancelar" icon="pi pi-times" class="p-button-text" 
                (click)="hideDialog()"></button>
        <button pButton pRipple label="Guardar" icon="pi pi-check" class="p-button-text" 
                (click)="saveEditedAuto()"></button>
    </ng-template>
</p-dialog>

<p-toast></p-toast>
<p-confirmDialog [style]="{width: '450px'}"></p-confirmDialog>
